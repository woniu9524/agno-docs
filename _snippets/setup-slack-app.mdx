## 设置和配置
<Steps>

<Step title="先决条件">
请确保您已具备以下条件：
- 拥有管理员权限的 Slack 工作区
- ngrok（用于开发）
- Python 3.7+
</Step>

<Step title="创建 Slack 应用">
1. 前往 [Slack 应用目录](https://api.slack.com/apps)
2. 点击“创建新应用”
3. 选择“从头开始”
4. 提供：
    - 应用名称
    - 要安装到的工作区
5. 点击“创建应用”
</Step>

<Step title="配置 OAuth 和权限">
1. 在 Slack 应用设置中导航至“OAuth & Permissions”
2. 在“Scopes”下，点击“Add an OAuth Scope”
3. 添加以下 Bot Token Scopes：
   - `app_mention`
   - `chat:write`
   - `chat:write.customize`
   - `chat:write.public`
   - `im:history`
   - `im:read`
   - `im:write`
4. 滚动到顶部，点击“Install to Workspace”
5. 点击“Allow”授权应用
</Step>

<Step title="设置环境变量">
在项目根目录下创建一个 `.envrc` 文件，并包含以下内容，将占位符值替换为您的实际凭证：
```bash
export SLACK_TOKEN="xoxb-your-bot-user-token"  # Bot User OAuth Token
export SLACK_SIGNING_SECRET="your-signing-secret"  # App Signing Secret
```

在您的 Slack 应用设置中找到这些值：
- Bot User OAuth Token：位于“OAuth & Permissions”下
- Signing Secret：位于“Basic Information” > “App Credentials”下

确保您的 shell 已加载此文件（例如，通过使用 `direnv allow`）。
</Step>

<Step title="使用 ngrok 设置 Webhook">
1. 对于本地开发，请使用 ngrok 将您的本地服务器暴露到互联网：
   ```bash
   ngrok http 8000
   # 或者，如果您有付费 ngrok 计划并拥有静态域名：
   # ngrok http --domain=your-custom-domain.ngrok-free.app 8000
   ```
2. 复制 ngrok 提供的 `https://` URL
3. 在您的 Slack 应用设置中，转到“Event Subscriptions”
4. 通过切换开关来启用事件
5. 添加您的请求 URL：
   - 格式：`https://your-ngrok-url.ngrok.io/slack/events`
6. 等待 Slack 验证终结点（您的应用必须正在运行）
</Step>

<Step title="配置事件订阅">
1. 在 Event Subscriptions 的“Subscribe to bot events”下：
2. 点击“Add Bot User Event”并添加：
   - `app_mention`
   - `message.im`
   - `message.channels`
   - `message.groups`
3. 点击“Save Changes”
4. 重新安装您的应用以应用新的权限
</Step>

<Step title="启用应用主页">
1. 在 Slack 应用设置中转到“App Home”
2. 在“Show Tabs”下：
   - 启用“Messages Tab”
   - 勾选“Allow users to send Slash commands and messages from the messages tab”
3. 保存更改
</Step>

<Step title="最终安装">
1. 返回 Slack 应用设置中的“Install App”
2. 点击“Reinstall to Workspace”
3. 使用新的权限授权应用
4. 您的应用现在已准备就绪！
</Step>

</Steps>