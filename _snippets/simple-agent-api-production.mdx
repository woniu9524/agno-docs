## 在生产环境中运行

本仓库包含一个 `Dockerfile`，用于构建适用于生产环境的容器镜像版本的应用程序。

在生产环境中运行的一般流程是：

1.  更新 `scripts/build_image.sh` 文件并设置您的 `IMAGE_NAME` 和 `IMAGE_TAG` 变量。
2.  构建镜像并将其推送到您的容器镜像仓库：
    ```bash
    ./scripts/build_image.sh
    ```
3.  在您选择的云服务提供商上运行。

### 详细步骤

#### 1. 为生产环境进行配置

-   确保您的生产环境环境变量（例如 `OPENAI_API_KEY`、数据库连接字符串）得到安全管理。大多数云服务提供商都提供一种方法，将这些作为环境变量设置给您部署的服务。
-   检查 `/agents` 目录中的代理配置，并确保它们已根据您的生产需求进行设置（例如，正确的模型版本，任何特定于生产的设置）。

#### 2. 构建您的生产 Docker 镜像

更新 `scripts/build_image.sh` 脚本，设置您想要的 `IMAGE_NAME` 和 `IMAGE_TAG`（例如 `your-repo/agent-api:v1.0.0`）。

运行脚本来构建和推送镜像：

```bash
./scripts/build_image.sh
```

#### 3. 部署到云服务

将镜像推送到镜像仓库后，您可以将其部署到支持容器化应用程序的各种云服务。一些常见的选项包括：

**无服务器容器平台：**

-   [Google Cloud Run](https://cloud.google.com/run)：一个全托管平台，可自动扩展您的无状态容器。
-   [AWS App Runner](https://aws.amazon.com/apprunner/)：轻松大规模部署容器化的 Web 应用程序和 API。
-   [Azure Container Apps](https://azure.microsoft.com/en-us/products/container-apps/)：使用无服务器容器构建和部署现代应用程序和微服务。

**容器编排服务：**

-   [Amazon Elastic Container Service (ECS)](https://aws.amazon.com/ecs/)：通常与 AWS Fargate 结合用于无服务器计算，或与 EC2 实例结合使用。
-   [Google Kubernetes Engine (GKE)](https://cloud.google.com/kubernetes-engine)：托管的 Kubernetes 服务。
-   [Azure Kubernetes Service (AKS)](https://azure.microsoft.com/en-us/services/kubernetes-service/)：托管的 Kubernetes 服务。

**支持 Docker 的平台即服务 (PaaS)：**

-   [Railway.app](https://railway.app/)：从 Dockerfile 轻松部署。
-   [Render](https://render.com/)：简化 Docker 容器、数据库和静态站点的部署。
-   [Heroku](https://www.heroku.com/)：支持部署 Docker 容器。

**专业平台：**

-   [Modal](https://modal.com/)：用于在云端运行 Python 代码的平台，可以提供 Web 端点。

具体的部署步骤将因所选提供商而异。通常，您需要将服务指向镜像仓库中的容器镜像，并配置端口映射（应用程序默认在端口 `8000` 上运行）、环境变量、扩展和数据库连接。

#### 4. 数据库配置

默认的 `docker-compose.yml` 文件为本地开发设置了一个 PostgreSQL 数据库。在生产环境中，请使用托管数据库服务（例如 AWS RDS、Google Cloud SQL、Azure Database for PostgreSQL）。
确保您的已部署应用程序配置了生产数据库的正确数据库连接 URL，通常通过环境变量进行配置。