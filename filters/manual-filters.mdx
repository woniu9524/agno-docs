# 手动知识过滤器

手动过滤通过在代码中直接指定过滤器，让您可以完全控制要搜索的文档。

## 步骤 1：附加元数据

有两种方法可以为文档附加元数据：

1. **初始化知识库时附加元数据**

    ```python
    knowledge_base = PDFKnowledgeBase(
        path=[
            {
                "path": "path/to/cv1.pdf",
                "metadata": {
                    "user_id": "jordan_mitchell",
                    "document_type": "cv",
                    "year": 2025,
                },
            },
            # ... 更多文档 ...
        ],
        vector_db=vector_db,
    )
    knowledge_base.load(recreate=True)
    ```

2. **逐个加载文档时附加元数据**

    ```python
    # 初始化 PDFKnowledgeBase
    knowledge_base = PDFKnowledgeBase(
        vector_db=vector_db,
        num_documents=5,
    )

    # 加载带有 user_1 元数据的第一个文档
    knowledge_base.load_document(
        path=path/to/cv1.pdf,
        metadata={"user_id": "jordan_mitchell", "document_type": "cv", "year": 2025},
        recreate=True,  # 仅在首次运行时设置为 True，之后设置为 False
    )

    # 加载带有 user_2 元数据的第二个文档
    knowledge_base.load_document(
        path=path/to/cv2.pdf,
        metadata={"user_id": "taylor_brooks", "document_type": "cv", "year": 2025},
    )
    ```

---

> 💡 **提示：**
> • 如果您一次性准备好了所有文档和元数据，请使用**选项 1**。
> • 如果您想逐步添加文档或在文档可用时添加，请使用**选项 2**。

## 步骤 2：使用过滤器查询

您可以通过两种方式传递过滤器：

### 1. 在 Agent 上设置（适用于所有查询）

```python
agent = Agent(
    knowledge=knowledge_base,
    search_knowledge=True,
    knowledge_filters={"user_id": "jordan_mitchell"},
)
agent.print_response(
    "讲讲 Jordan Mitchell 的经验和技能",
    markdown=True,
)
```

### 2. 在每次查询时设置（会覆盖该次运行的 Agent 过滤器）

```python
agent = Agent(
    knowledge=knowledge_base,
    search_knowledge=True,
)
agent.print_response(
    "讲讲 Jordan Mitchell 的经验和技能",
    knowledge_filters={"user_id": "jordan_mitchell"},
    markdown=True,
)
```

<Note>如果您同时在 Agent 和查询上都设置了过滤器，那么查询级别的过滤器将具有优先权。</Note>

## 组合多个过滤器

您可以按多个字段进行过滤：

```python
agent = Agent(
    knowledge=knowledge_base,
    search_knowledge=True,
    knowledge_filters={
        "user_id": "jordan_mitchell",
        "document_type": "cv",
        "year": 2025,
    }
)
agent.print_response(
    "讲讲 Jordan Mitchell 的经验和技能",
    markdown=True,
)
```

## 自己动手试试！

- 使用不同的元数据加载文档。
- 使用不同的过滤器组合进行查询。
- 观察结果如何变化！

---

## 开发者资源
- [手动过滤](https://github.com/agno-agi/agno/blob/main/cookbook/agent_concepts/knowledge/filters/pdf/filtering.py)
- [加载时手动过滤](https://github.com/agno-agi/agno/blob/main/cookbook/agent_concepts/knowledge/filters/pdf/filtering_on_load.py)