---
title: äººæœºåä½œ
---

äººæœºåä½œ (HITL) åŠŸèƒ½å…è®¸ä½ åœ¨æ‰§è¡Œå·¥å…·è°ƒç”¨ä¹‹å‰æˆ–ä¹‹åè·å–ç”¨æˆ·çš„è¾“å…¥ã€‚

ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨æ‰§è¡Œå·¥å…·è°ƒç”¨ä¹‹å‰ä½¿ç”¨å·¥å…·é’©å­è·å–ç”¨æˆ·ç¡®è®¤ã€‚

## ç¤ºä¾‹ï¼šä½¿ç”¨å·¥å…·é’©å­å®ç°äººæœºåä½œ

æœ¬ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ï¼š
- ä¸ºå·¥å…·æ·»åŠ ç”¨æˆ·ç¡®è®¤é’©å­
- åœ¨å·¥å…·æ‰§è¡ŒæœŸé—´å¤„ç†ç”¨æˆ·è¾“å…¥
- æ ¹æ®ç”¨æˆ·çš„é€‰æ‹©ä¼˜é›…åœ°å–æ¶ˆæ“ä½œ

```python hitl.py
"""ğŸ¤ äººæœºåä½œï¼šä¸ºå·¥å…·è°ƒç”¨æ·»åŠ ç”¨æˆ·ç¡®è®¤

æœ¬ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ Agno å·¥å…·ä¸­å®ç°äººæœºåä½œåŠŸèƒ½ã€‚
å®ƒæ¼”ç¤ºäº†å¦‚ä½•ï¼š
- ä¸ºå·¥å…·æ·»åŠ ç”¨æˆ·ç¡®è®¤é’©å­
- åœ¨å·¥å…·æ‰§è¡ŒæœŸé—´å¤„ç†ç”¨æˆ·è¾“å…¥
- æ ¹æ®ç”¨æˆ·çš„é€‰æ‹©ä¼˜é›…åœ°å–æ¶ˆæ“ä½œ

ä¸€äº›å®é™…åº”ç”¨ï¼š
- åœ¨æ‰§è¡Œå‰ç¡®è®¤æ•æ„Ÿæ“ä½œ
- åœ¨ç”Ÿæˆ API è°ƒç”¨å‰è¿›è¡Œå®¡æŸ¥
- éªŒè¯æ•°æ®è½¬æ¢
- åœ¨å…³é”®ç³»ç»Ÿä¸­æ‰¹å‡†è‡ªåŠ¨åŒ–æ“ä½œ

è¿è¡Œ `pip install openai httpx rich agno` æ¥å®‰è£…ä¾èµ–é¡¹ã€‚
"""

import json
from typing import Any, Callable, Dict, Iterator

import httpx
from agno.agent import Agent
from agno.exceptions import StopAgentRun
from agno.models.openai import OpenAIChat
from agno.tools import FunctionCall, tool
from rich.console import Console
from rich.pretty import pprint
from rich.prompt import Prompt

# è¿™æ˜¯æ§åˆ¶å°ç”¨äº print_response æ–¹æ³•çš„å®ä¾‹
# æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥åœæ­¢å’Œé‡æ–°å¯åŠ¨å®æ—¶æ˜¾ç¤ºå¹¶è¯·æ±‚ç”¨æˆ·ç¡®è®¤
console = Console()


def confirmation_hook(
    function_name: str, function_call: Callable, arguments: Dict[str, Any]
):
    # ä»æ§åˆ¶å°è·å–å®æ—¶æ˜¾ç¤ºå®ä¾‹
    live = console._live

    # æš‚æ—¶åœæ­¢å®æ—¶æ˜¾ç¤ºï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è¯·æ±‚ç”¨æˆ·ç¡®è®¤
    live.stop()  # type: ignore

    # è¯·æ±‚ç¡®è®¤
    console.print(f"\nå³å°†è¿è¡Œ [bold blue]{fc.function.name}[/]")
    message = (
        Prompt.ask("æ˜¯å¦ç»§ç»­?", choices=["y", "n"], default="y")
        .strip()
        .lower()
    )

    # é‡æ–°å¯åŠ¨å®æ—¶æ˜¾ç¤º
    live.start()  # type: ignore

    # å¦‚æœç”¨æˆ·ä¸æƒ³ç»§ç»­ï¼Œåˆ™å¼•å‘ StopExecution å¼‚å¸¸
    if message != "y":
        raise StopAgentRun(
            "ç”¨æˆ·å·²å–æ¶ˆå·¥å…·è°ƒç”¨",
            agent_message="ç”±äºæœªè·å¾—æƒé™ï¼Œå°†åœæ­¢æ‰§è¡Œã€‚",
        )
    
    # è°ƒç”¨å‡½æ•°
    result = function_call(**arguments)

    # å¯é€‰åœ°è½¬æ¢ç»“æœ

    return result


@tool(tool_hooks=[confirmation_hook])
def get_top_hackernews_stories(num_stories: int) -> Iterator[str]:
    """è·å– Hacker News çš„çƒ­é—¨æ•…äº‹ã€‚

    Args:
        num_stories (int): è¦æ£€ç´¢çš„æ•…äº‹æ•°é‡

    Returns:
        str: åŒ…å«æ•…äº‹è¯¦ç»†ä¿¡æ¯çš„ JSON å­—ç¬¦ä¸²
    """
    # è·å–çƒ­é—¨æ•…äº‹ ID
    response = httpx.get("https://hacker-news.firebaseio.com/v0/topstories.json")
    story_ids = response.json()

    # è¿”å›æ•…äº‹è¯¦æƒ…
    final_stories = []
    for story_id in story_ids[:num_stories]:
        story_response = httpx.get(
            f"https://hacker-news.firebaseio.com/v0/item/{story_id}.json"
        )
        story = story_response.json()
        if "text" in story:
            story.pop("text", None)
        final_stories.append(story)

    return json.dumps(final_stories)


# åˆå§‹åŒ–ä»£ç†ï¼Œèµ‹äºˆå…¶æŠ€æœ¯å¨´ç†Ÿçš„ä¸ªæ€§å¹¶æä¾›æ¸…æ™°çš„æŒ‡ç¤º
agent = Agent(
    model=OpenAIChat(id="gpt-4o-mini"),
    tools=[get_top_hackernews_stories],
    markdown=True,
)

agent.print_response(
    "è·å– Hacker News çš„å‰ 2 æ¡çƒ­é—¨æ•…äº‹ï¼Ÿ", stream=True, console=console
)
```