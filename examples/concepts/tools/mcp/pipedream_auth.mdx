---
title: "Pipedream è®¤è¯"
description: "æœ¬ç¤ºä¾‹å±•ç¤ºäº†åœ¨é›†æˆ Pipedream MCP æœåŠ¡å™¨æ—¶å¦‚ä½•æ·»åŠ æˆæƒä»¥ä¸ Agno Agents è¿æ¥ã€‚"
---

## Code

```python
"""
ğŸ”’ ä½¿ç”¨ Pipedream MCP æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯

è¿™æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•ä½¿ç”¨ Pipedream MCP æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯çš„ç¤ºä¾‹ã€‚
å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä»£è¡¨ç”¨æˆ·ä¸ MCP æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œè¿™å°†éå¸¸æœ‰ç”¨ã€‚

1. è·å–æ‚¨çš„è®¿é—®ä»¤ç‰Œã€‚æ‚¨å¯ä»¥åœ¨ Pipedream çš„æ–‡æ¡£ä¸­æŸ¥çœ‹å¦‚ä½•æ“ä½œï¼šhttps://pipedream.com/docs/connect/mcp/developers/
2. è·å– MCP æœåŠ¡å™¨çš„ URLã€‚å®ƒçœ‹èµ·æ¥ä¼šåƒè¿™æ ·ï¼šhttps://remote.mcp.pipedream.net/<External user id>/<MCP app slug>
3. è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
    - MCP_SERVER_URL: æ‚¨ä¹‹å‰è·å–çš„ MCP æœåŠ¡å™¨çš„ URL
    - MCP_ACCESS_TOKEN: æ‚¨ä¹‹å‰è·å–çš„è®¿é—®ä»¤ç‰Œ
    - PIPEDREAM_PROJECT_ID: æ‚¨æƒ³ä½¿ç”¨çš„ Pipedream é¡¹ç›®çš„é¡¹ç›® ID
    - PIPEDREAM_ENVIRONMENT: æ‚¨æƒ³ä½¿ç”¨çš„ Pipedream ç¯å¢ƒçš„ç¯å¢ƒ
3. å®‰è£…ä¾èµ–é¡¹ï¼špip install agno mcp-sdk
"""

import asyncio
from os import getenv

from agno.agent import Agent
from agno.models.openai import OpenAIChat
from agno.tools.mcp import MCPTools, StreamableHTTPClientParams
from agno.utils.log import log_exception

mcp_server_url = getenv("MCP_SERVER_URL")
mcp_access_token = getenv("MCP_ACCESS_TOKEN")
pipedream_project_id = getenv("PIPEDREAM_PROJECT_ID")
pipedream_environment = getenv("PIPEDREAM_ENVIRONMENT")


server_params = StreamableHTTPClientParams(
    url=mcp_server_url,
    headers={
        "Authorization": f"Bearer {mcp_access_token}",
        "x-pd-project-id": pipedream_project_id,
        "x-pd-environment": pipedream_environment,
    },
)


async def run_agent(task: str) -> None:
    try:
        async with MCPTools(
            server_params=server_params, transport="streamable-http", timeout_seconds=20
        ) as mcp:
            agent = Agent(
                model=OpenAIChat(id="gpt-4o-mini"),
                tools=[mcp],
                markdown=True,
            )
            await agent.aprint_response(message=task, stream=True)
    except Exception as e:
        log_exception(f"Unexpected error: {e}")


if __name__ == "__main__":
    # Agent å¯ä»¥è¯»å– channels, users, messages ç­‰
    asyncio.run(run_agent("Show me the latest message in the channel #general"))
```