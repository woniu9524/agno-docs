---
title: Stripe MCP ä»£ç†
sidebarTitle: Stripe
---

ä½¿ç”¨ [Stripe MCP æœåŠ¡å™¨](https://github.com/stripe/agent-toolkit/tree/main/modelcontextprotocol) æ¥åˆ›å»ºä¸€ä¸ªå¯ä»¥ä¸ Stripe API äº¤äº’çš„ä»£ç†ï¼š

```python
"""ğŸ’µ Stripe MCP ä»£ç† - ç®¡ç†æ‚¨çš„ Stripe æ“ä½œ

æœ¬ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ª Agno ä»£ç†ï¼Œé€šè¿‡æ¨¡å‹ä¸Šä¸‹æ–‡åè®® (MCP) ä¸ Stripe API è¿›è¡Œäº¤äº’ã€‚è¯¥ä»£ç†å¯ä»¥ä½¿ç”¨è‡ªç„¶è¯­è¨€å‘½ä»¤åˆ›å»ºå’Œç®¡ç† Stripe å¯¹è±¡ï¼Œå¦‚å®¢æˆ·ã€äº§å“ã€ä»·æ ¼å’Œæ”¯ä»˜é“¾æ¥ã€‚


è®¾ç½®ï¼š
2. å®‰è£… Python ä¾èµ–ï¼š`pip install agno mcp-sdk`
3. è®¾ç½®ç¯å¢ƒå˜é‡ï¼šexport STRIPE_SECRET_KEY=***ã€‚

Stripe MCP æ–‡æ¡£ï¼šhttps://github.com/stripe/agent-toolkit
"""

import asyncio
import os
from textwrap import dedent

from agno.agent import Agent
from agno.tools.mcp import MCPTools
from agno.utils.log import log_error, log_exception, log_info


async def run_agent(message: str) -> None:
    """
    è®¾ç½® Stripe MCP æœåŠ¡å™¨å¹¶åˆå§‹åŒ– Agno ä»£ç†
    """
    # éªŒè¯ Stripe API å¯†é’¥æ˜¯å¦å¯ç”¨
    stripe_api_key = os.getenv("STRIPE_SECRET_KEY")
    if not stripe_api_key:
        log_error("æœªè®¾ç½® STRIPE_SECRET_KEY ç¯å¢ƒå˜é‡ã€‚")
        return

    enabled_tools = "paymentLinks.create,products.create,prices.create,customers.create,customers.read"

    # å¤„ç†ä¸åŒçš„æ“ä½œç³»ç»Ÿ
    npx_command = "npx.cmd" if os.name == "nt" else "npx"

    try:
        # ä½¿ç”¨ Stripe æœåŠ¡å™¨åˆå§‹åŒ– MCP å·¥å…·åŒ…
        async with MCPTools(
            command=f"{npx_command} -y @stripe/mcp --tools={enabled_tools} --api-key={stripe_api_key}"
        ) as mcp_toolkit:
            agent = Agent(
                name="StripeAgent",
                instructions=dedent("""\
                    æ‚¨æ˜¯ä¸“ç²¾äº Stripe æ“ä½œçš„ AI åŠ©æ‰‹ã€‚
                    æ‚¨ä½¿ç”¨æä¾›çš„å·¥å…·ä¸ Stripe API è¿›è¡Œäº¤äº’ã€‚

                    - ç†è§£ç”¨æˆ·åˆ›å»ºæˆ–åˆ—å‡º Stripe å¯¹è±¡ï¼ˆå®¢æˆ·ã€äº§å“ã€ä»·æ ¼ã€æ”¯ä»˜é“¾æ¥ï¼‰çš„è¯·æ±‚ã€‚
                    - æ¸…æ™°é™ˆè¿°æ‚¨æ“ä½œçš„ç»“æœï¼ŒåŒ…æ‹¬åˆ›å»ºå¯¹è±¡çš„ ID æˆ–æ£€ç´¢åˆ°çš„åˆ—è¡¨ã€‚
                    - å¦‚æœè¯·æ±‚ä¸æ˜ç¡®ï¼Œè¯·è¯·æ±‚æ¾„æ¸…ã€‚
                    - ä½¿ç”¨ Markdown æ ¼å¼ï¼Œå°¤å…¶æ˜¯åœ¨é“¾æ¥æˆ–ä»£ç ç‰‡æ®µä¸­ã€‚
                    - å¦‚æœè¯·æ±‚æ¶‰åŠå¤šä¸ªæ“ä½œï¼ˆä¾‹å¦‚ï¼Œå…ˆåˆ›å»ºäº§å“ï¼Œç„¶ååˆ›å»ºä»·æ ¼ï¼Œæœ€ååˆ›å»ºé“¾æ¥ï¼‰ï¼Œè¯·æŒ‰é¡ºåºæ‰§è¡Œå¿…è¦æ­¥éª¤ã€‚
                """),
                tools=[mcp_toolkit],
                markdown=True,
                show_tool_calls=True,
            )

            # ä½¿ç”¨æŒ‡å®šçš„ä»»åŠ¡è¿è¡Œä»£ç†
            log_info(f"æ­£åœ¨ä½¿ç”¨æŒ‡æ´¾çš„ä»»åŠ¡è¿è¡Œä»£ç†ï¼š'{message}'")
            await agent.aprint_response(message, stream=True)

    except FileNotFoundError:
        error_msg = f"é”™è¯¯ï¼šæ‰¾ä¸åˆ° '{npx_command}' å‘½ä»¤ã€‚è¯·ç¡®ä¿å·²åœ¨ç³»ç»Ÿ PATH ä¸­å®‰è£… Node.js å’Œ npm/npxã€‚"
        log_error(error_msg)
    except Exception as e:
        log_exception(f"ä»£ç†æ‰§è¡ŒæœŸé—´å‘ç”Ÿæ„å¤–é”™è¯¯ï¼š{e}")


if __name__ == "__main__":
    task = "åˆ›å»ºä¸€ä¸ªåä¸º 'iPhone' çš„æ–° Stripe äº§å“ã€‚ç„¶åä¸ºå…¶åˆ›å»ºä¸€ä¸ªä»·æ ¼ $999.99 ç¾å…ƒã€‚æœ€åï¼Œä¸ºæ­¤ä»·æ ¼åˆ›å»ºä¸€ä¸ªæ”¯ä»˜é“¾æ¥ã€‚"
    asyncio.run(run_agent(task))


# ç¤ºä¾‹æç¤ºï¼š
"""
å®¢æˆ·ç®¡ç†ï¼š
- "åˆ›å»ºä¸€ä¸ªå®¢æˆ·ã€‚åç§°ï¼šACME å…¬å¸, é‚®ç®±ï¼šbilling@acme.example.com"
- "åˆ—å‡ºæˆ‘çš„å®¢æˆ·ã€‚"
- "é€šè¿‡é‚®ç®±æŸ¥æ‰¾å®¢æˆ· 'jane.doe@example.com'" # æ³¨æ„ï¼šè¿™éœ€è¦ 'customers.retrieve' æˆ–æœç´¢åŠŸèƒ½

äº§å“å’Œä»·æ ¼ç®¡ç†ï¼š
- "åˆ›å»ºä¸€ä¸ªåä¸º 'Basic Plan' çš„æ–°äº§å“ã€‚"
- "ä¸ºäº§å“ 'Basic Plan' åˆ›å»ºä¸€ä¸ªæ¯æœˆrecurringçš„ä»·æ ¼ï¼Œä»·æ ¼ä¸º $10 ç¾å…ƒã€‚"
- "åˆ›å»ºä¸€ä¸ªäº§å“ 'Ebook Download' å’Œä¸€ä¸ªä¸€æ¬¡æ€§ä»·æ ¼ $19.95 ç¾å…ƒã€‚"
- "åˆ—å‡ºæ‰€æœ‰äº§å“ã€‚" # æ³¨æ„ï¼šè¿™éœ€è¦ 'products.list' åŠŸèƒ½
- "åˆ—å‡ºæ‰€æœ‰ä»·æ ¼ã€‚" # æ³¨æ„ï¼šè¿™éœ€è¦ 'prices.list' åŠŸèƒ½

æ”¯ä»˜é“¾æ¥ï¼š
- "ä¸ºæ¯æœˆ $10 ç¾å…ƒçš„ 'Basic Plan' ä»·æ ¼åˆ›å»ºä¸€ä¸ªæ”¯ä»˜é“¾æ¥ã€‚"
- "ä¸º '$19.95 Ebook Download' ç”Ÿæˆä¸€ä¸ªæ”¯ä»˜é“¾æ¥ã€‚"

ç»„åˆä»»åŠ¡ï¼š
- "åˆ›å»ºä¸€ä¸ªäº§å“ 'Pro Service'ï¼Œæ·»åŠ ä¸€ä¸ªä¸€æ¬¡æ€§ä»·æ ¼ $150 ç¾å…ƒï¼Œå¹¶ç»™æˆ‘æ”¯ä»˜é“¾æ¥ã€‚"
- "æ³¨å†Œä¸€ä¸ªæ–°å®¢æˆ· 'support@example.example.com'ï¼Œåç§°ä¸º 'Support Team'ã€‚"
"""
```