---
title: Agent with Storage
---

## Code

```python cookbook/models/ibm/watsonx/storage.py
from agno.agent import Agent
from agno.models.ibm import WatsonX
from agno.storage.postgres import PostgresStorage
from agno.tools.duckduckgo import DuckDuckGoTools

db_url = "postgresql+psycopg://ai:ai@localhost:5532/ai"

agent = Agent(
    model=WatsonX(id="ibm/granite-20b-code-instruct"),
    storage=PostgresStorage(table_name="agent_sessions", db_url=db_url),
    tools=[DuckDuckGoTools()],
    add_history_to_messages=True,
)
agent.print_response("How many people live in Canada?")
agent.print_response("What is their national anthem called?")
```

## Usage

<Steps>
  <Snippet file="create-venv-step.mdx" />

  <Step title="Set your API key">
    ```bash
    export IBM_WATSONX_API_KEY=xxx
    export IBM_WATSONX_PROJECT_ID=xxx
    ```
  </Step>

  <Step title="Install libraries">
    ```bash
    pip install -U ibm-watsonx-ai sqlalchemy psycopg duckduckgo-search agno
    ```
  </Step>

  <Step title="Set up PostgreSQL">
    Make sure you have a PostgreSQL database running. You can adjust the `db_url` in the code to match your database configuration.
  </Step>

  <Step title="Run Agent">
    <CodeGroup>
    ```bash Mac
    python cookbook/models/ibm/watsonx/storage.py
    ```

    ```bash Windows
    python cookbook\models\ibm\watsonx\storage.py
    ```
    </CodeGroup>
  </Step>
</Steps>

本示例展示了如何使用 PostgreSQL 存储与 IBM WatsonX 结合以在多次交互中维护对话状态。它创建了一个带有 PostgreSQL 存储后端的 agent，并发送了多条消息，在消息之间会保留对话历史记录。

注意：您需要安装 `sqlalchemy` 包并拥有一个可用的 PostgreSQL 数据库。