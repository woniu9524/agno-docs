---
title: ä¸ªæ€§åŒ–é‚®ä»¶ç”Ÿæˆå™¨
---


æ­¤å·¥ä½œæµé€šè¿‡ä»¥ä¸‹æ–¹å¼å¸®åŠ©é”€å”®ä¸“ä¸šäººå£«æ’°å†™é«˜åº¦ä¸ªæ€§åŒ–çš„å†·é‚®ä»¶ï¼š
1. é€šè¿‡ç½‘ç«™ç ”ç©¶ç›®æ ‡å…¬å¸
2. åˆ†æå…¶å•†ä¸šæ¨¡å¼ã€æŠ€æœ¯æ ˆå’Œç‹¬ç‰¹å±æ€§
3. ç”Ÿæˆä¸ªæ€§åŒ–çš„é‚®ä»¶è‰ç¨¿
4. åœ¨å®é™…å¤–è”å‰ï¼Œå…ˆå‘é€æµ‹è¯•é‚®ä»¶ç»™è‡ªå·±ä»¥ä¾›å®¡é˜…

ä¸ºä»€ä¹ˆè¿™å¾ˆæœ‰å¸®åŠ©ï¼Ÿ
--------------------------------------------------------------------------------
â€¢ æ‚¨å§‹ç»ˆå¤šäº†ä¸€ä¸ªå®¡é˜…æ­¥éª¤â€”â€”é‚®ä»¶ä¼šå…ˆå‘é€ç»™æ‚¨ã€‚
  è¿™æ ·å¯ä»¥ç¡®ä¿æ‚¨åœ¨è§¦è¾¾å®é™…æ½œåœ¨å®¢æˆ·ä¹‹å‰å¾®è°ƒæ¶ˆæ¯ã€‚
â€¢ éå¸¸é€‚åˆæ‰¹é‡è¿­ä»£è¯­æ°”ã€é£æ ¼å’Œä¸ªæ€§åŒ–è®¾ç½®ã€‚

è°åº”è¯¥ä½¿ç”¨è¿™ä¸ªï¼Ÿ
--------------------------------------------------------------------------------
â€¢ SDRã€å®¢æˆ·ä¸»ç®¡ã€ä¸šåŠ¡å‘å±•ç»ç†
â€¢ åˆ›å§‹äººã€è¥é”€ä¸“ä¸šäººå£«ã€B2B é”€å”®ä»£è¡¨
â€¢ ä»»ä½•å¤§è§„æ¨¡å»ºç«‹å…³ç³»æˆ–è¿›è¡Œå¤–è”çš„äºº

ç¤ºä¾‹ç”¨ä¾‹ï¼š
--------------------------------------------------------------------------------
â€¢ SaaS é”€å”®å¤–è”
â€¢ å’¨è¯¢æœåŠ¡ææ¡ˆ
â€¢ åˆä½œæœºä¼š
â€¢ æŠ•èµ„è€…å…³ç³»
â€¢ æ‹›è˜å¤–è”
â€¢ æ´»åŠ¨é‚€è¯·

å¿«é€Ÿå¼€å§‹ï¼š
--------------------------------------------------------------------------------
1. å®‰è£…ä¾èµ–é¡¹ï¼š
   pip install openai agno

2. è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
   - export OPENAI_API_KEY="xxxx"

3. ä½¿ç”¨æ‚¨çš„ä¿¡æ¯æ›´æ–° `sender_details_dict`ã€‚

4. å°†ç›®æ ‡å…¬å¸æ·»åŠ åˆ°â€œleadsâ€å­—å…¸ä¸­ã€‚

5. è¿è¡Œï¼š
   python personalized_email_generator.py

å¦‚æœ `DEMO_MODE`=Falseï¼Œè„šæœ¬å°†é¦–å…ˆå°†è‰ç¨¿é‚®ä»¶å‘é€ç»™æ‚¨ã€‚
å¦‚æœ `DEMO_MODE`=Trueï¼Œå®ƒä¼šå°†é‚®ä»¶æ‰“å°åˆ°æ§åˆ¶å°ä¾›æ‚¨å®¡é˜…ã€‚

ç„¶åï¼Œæ‚¨å¯ä»¥æ”¾å¿ƒåœ°å°†ä¼˜åŒ–åçš„é‚®ä»¶å‘é€ç»™æ‚¨çš„æ½œåœ¨å®¢æˆ·ï¼

## ä»£ç 

```python personalized_email_generator.py
import json
from datetime import datetime
from textwrap import dedent
from typing import Dict, Iterator, List, Optional

from agno.agent import Agent
from agno.models.openai import OpenAIChat
from agno.storage.sqlite import SqliteStorage
from agno.tools.exa import ExaTools
from agno.utils.log import logger
from agno.utils.pprint import pprint_run_response
from agno.workflow import RunResponse, Workflow
from pydantic import BaseModel, Field

# æ¼”ç¤ºæ¨¡å¼
# - è®¾ç½®ä¸º True å°†é‚®ä»¶æ‰“å°åˆ°æ§åˆ¶å°
# - è®¾ç½®ä¸º False å°†é‚®ä»¶å‘é€ç»™æ‚¨è‡ªå·±
DEMO_MODE = True
today = datetime.now().strftime("%Y-%m-%d")

# ç¤ºä¾‹æ½œåœ¨å®¢æˆ· - æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ç›®æ ‡
leads: Dict[str, Dict[str, str]] = {
    "Notion": {
        "name": "Notion",
        "website": "https://www.notion.so",
        "contact_name": "Ivan Zhao",
        "position": "CEO",
    },
    # æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šå…¬å¸
}

# æ›´æ–°åçš„ AI åˆ†æå…¬å¸å‘é€è€…è¯¦ç»†ä¿¡æ¯
sender_details_dict: Dict[str, str] = {
    "name": "Sarah Chen",
    "email": "your.email@company.com",  # åœ¨æ­¤å¤„å¡«å†™æ‚¨çš„é‚®ç®±
    "organization": "Data Consultants Inc",
    "service_offered": "We help build data products and offer data consulting services",
    "calendar_link": "https://calendly.com/data-consultants-inc",
    "linkedin": "https://linkedin.com/in/your-profile",
    "phone": "+1 (555) 123-4567",
    "website": "https://www.data-consultants.com",
}

email_template = """\
å˜¿ [RECIPIENT_NAME]

[PERSONAL_NOTE]

[PROBLEM_THEY_HAVE]

[SOLUTION_YOU_OFFER]

[SOCIAL_PROOF]

è¿™æ˜¯æˆ‘çš„æ—¥å†é“¾æ¥ï¼Œå¦‚æœæ‚¨æ–¹ä¾¿çš„è¯å¯ä»¥å®‰æ’é€šè¯ï¼š[CALENDAR_LINK] â˜•ï¸

[SIGNATURE]

P.S. æ‚¨ä¹Ÿå¯ä»¥åœ¨ X ä¸Šç»™æˆ‘å‘ç§ä¿¡\
"""


class CompanyInfo(BaseModel):
    """
    å­˜å‚¨åœ¨ç ”ç©¶é˜¶æ®µæ”¶é›†åˆ°çš„å…¬å¸æ·±åº¦æ•°æ®ã€‚
    """

    # åŸºæœ¬ä¿¡æ¯
    company_name: str = Field(..., description="å…¬å¸åç§°")
    website_url: str = Field(..., description="å…¬å¸ç½‘ç«™ URL")

    # ä¸šåŠ¡è¯¦æƒ…
    industry: Optional[str] = Field(None, description="ä¸»è¦è¡Œä¸š")
    core_business: Optional[str] = Field(None, description="ä¸»è¦ä¸šåŠ¡ç„¦ç‚¹")
    business_model: Optional[str] = Field(None, description="B2B, B2C ç­‰")

    # è¥é”€ä¿¡æ¯
    motto: Optional[str] = Field(None, description="å…¬å¸æ ‡è¯­/å£å·")
    value_proposition: Optional[str] = Field(None, description="ä¸»è¦ä»·å€¼ä¸»å¼ ")
    target_audience: Optional[List[str]] = Field(
        None, description="ç›®æ ‡å®¢æˆ·ç»†åˆ†"
    )

    # å…¬å¸æŒ‡æ ‡
    company_size: Optional[str] = Field(None, description="å‘˜å·¥æ•°é‡èŒƒå›´")
    founded_year: Optional[int] = Field(None, description="æˆç«‹å¹´ä»½")
    locations: Optional[List[str]] = Field(None, description="åŠå…¬å®¤åœ°ç‚¹")

    # æŠ€æœ¯è¯¦æƒ…
    technologies: Optional[List[str]] = Field(None, description="æŠ€æœ¯æ ˆ")
    integrations: Optional[List[str]] = Field(None, description="è½¯ä»¶é›†æˆ")

    # å¸‚åœºåœ°ä½
    competitors: Optional[List[str]] = Field(None, description="ä¸»è¦ç«äº‰å¯¹æ‰‹")
    unique_selling_points: Optional[List[str]] = Field(
        None, description="å…³é”®å·®å¼‚åŒ–å› ç´ "
    )
    market_position: Optional[str] = Field(None, description="å¸‚åœºå®šä½")

    # ç¤¾ä¼šè¯æ˜
    customers: Optional[List[str]] = Field(None, description="çŸ¥åå®¢æˆ·")
    case_studies: Optional[List[str]] = Field(None, description="æˆåŠŸæ¡ˆä¾‹")
    awards: Optional[List[str]] = Field(None, description="å¥–é¡¹å’Œè®¤å¯")

    # è¿‘æœŸåŠ¨æ€
    recent_news: Optional[List[str]] = Field(None, description="è¿‘æœŸæ–°é—»/æ›´æ–°")
    blog_topics: Optional[List[str]] = Field(None, description="è¿‘æœŸåšå®¢ä¸»é¢˜")

    # ç—›ç‚¹ä¸æœºé‡
    challenges: Optional[List[str]] = Field(None, description="æ½œåœ¨ç—›ç‚¹")
    growth_areas: Optional[List[str]] = Field(None, description="å¢é•¿æœºé‡")

    # è”ç³»ä¿¡æ¯
    email_address: Optional[str] = Field(None, description="è”ç³»é‚®ç®±")
    phone: Optional[str] = Field(None, description="è”ç³»ç”µè¯")
    social_media: Optional[Dict[str, str]] = Field(
        None, description="ç¤¾äº¤åª’ä½“é“¾æ¥"
    )

    # é™„åŠ å­—æ®µ
    pricing_model: Optional[str] = Field(None, description="å®šä»·ç­–ç•¥å’Œå±‚çº§")
    user_base: Optional[str] = Field(None, description="é¢„è®¡ç”¨æˆ·åŸºç¡€è§„æ¨¡")
    key_features: Optional[List[str]] = Field(None, description="ä¸»è¦äº§å“åŠŸèƒ½")
    integration_ecosystem: Optional[List[str]] = Field(
        None, description="é›†æˆåˆä½œä¼™ä¼´"
    )
    funding_status: Optional[str] = Field(
        None, description="æœ€æ–°èèµ„ä¿¡æ¯"
    )
    growth_metrics: Optional[Dict[str, str]] = Field(
        None, description="å…³é”®å¢é•¿æŒ‡æ ‡"
    )


class PersonalisedEmailGenerator(Workflow):
    """
    ä¸ªæ€§åŒ–é‚®ä»¶ç”Ÿæˆç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿï¼š

    1. æŠ“å–ç›®æ ‡å…¬å¸ç½‘ç«™
    2. æ”¶é›†åŸºæœ¬ä¿¡æ¯ï¼ˆæŠ€æœ¯æ ˆã€å¸‚åœºåœ°ä½ã€æœ€æ–°åŠ¨æ€ï¼‰
    3. ç”Ÿæˆä¸ªæ€§åŒ–çš„å†·é‚®ä»¶ï¼Œç”¨äº B2B å¤–è”

    æ­¤å·¥ä½œæµæ—¨åœ¨å¸®åŠ©æ‚¨æ ¹æ®æ½œåœ¨å®¢æˆ·çš„å…·ä½“æƒ…å†µï¼Œè§£å†³å·²çŸ¥æŒ‘æˆ˜å¹¶çªå‡ºæ˜¾ç¤ºé‡èº«å®šåˆ¶çš„è§£å†³æ–¹æ¡ˆï¼Œä»è€Œæ’°å†™å…·æœ‰å¸å¼•åŠ›çš„å¤–è”é‚®ä»¶ã€‚
    """

    description: str = dedent("""\
        AI é©±åŠ¨çš„ B2B å¤–è”å·¥ä½œæµï¼š
        --------------------------------------------------------
        1. ç ”ç©¶ä¸åˆ†æ
        2. ç”Ÿæˆä¸ªæ€§åŒ–é‚®ä»¶
        3. å°†è‰ç¨¿å‘é€ç»™æ‚¨è‡ªå·±
        --------------------------------------------------------
        è¿™åˆ›å»ºäº†ä¸€ä¸ªæ— ç¼çš„å®¡é˜…å±‚ï¼Œè®©æ‚¨åœ¨å‘é€ç»™çœŸå®æ½œåœ¨å®¢æˆ·ä¹‹å‰å¯ä»¥ä¼˜åŒ–æ¯å°é‚®ä»¶ã€‚
        éå¸¸é€‚åˆæ•°æ®é©±åŠ¨çš„ã€ä¸ªæ€§åŒ–çš„ã€å¤§è§„æ¨¡çš„ B2B å¤–è”ã€‚
    """)

    scraper: Agent = Agent(
        model=OpenAIChat(id="gpt-4o"),
        tools=[ExaTools()],
        description=dedent("""\
            æ‚¨æ˜¯ä¸“æ³¨äºä»¥ä¸‹é¢†åŸŸçš„ä¸“ä¸š SaaS ä¸šåŠ¡åˆ†æå¸ˆï¼š

            ğŸ” äº§å“æ™ºèƒ½
            - åŠŸèƒ½åˆ†æ
            - ç”¨æˆ·ä½“éªŒè¯„ä¼°
            - é›†æˆèƒ½åŠ›
            - å¹³å°å¯æ‰©å±•æ€§
            - ä¼ä¸šå°±ç»ªåº¦

            ğŸ“Š å¸‚åœºåœ°ä½åˆ†æ
            - ç«äº‰ä¼˜åŠ¿
            - å¸‚åœºæ¸—é€ç‡
            - å¢é•¿è½¨è¿¹
            - ä¼ä¸šé‡‡ç”¨æƒ…å†µ
            - å›½é™…ä¸šåŠ¡

            ğŸ’¡ æŠ€æœ¯æ¶æ„
            - åŸºç¡€è®¾æ–½è®¾ç½®
            - å®‰å…¨æ ‡å‡†
            - API èƒ½åŠ›
            - æ•°æ®ç®¡ç†
            - åˆè§„çŠ¶æ€

            ğŸ¯ å•†ä¸šæ™ºèƒ½
            - æ”¶å…¥æ¨¡å¼åˆ†æ
            - å®¢æˆ·è·å–ç­–ç•¥
            - ä¼ä¸šç—›ç‚¹
            - æ‰©å±•æŒ‘æˆ˜
            - é›†æˆæœºä¼š\
        """),
        instructions=dedent("""\
            1. ä»å…¬å¸ç½‘ç«™å¼€å§‹ï¼Œåˆ†æï¼š
            - ä¸»é¡µæ¶ˆæ¯ä¼ é€’
            - äº§å“/æœåŠ¡é¡µé¢
            - å…³äºæˆ‘ä»¬éƒ¨åˆ†
            - åšå®¢å†…å®¹
            - æ¡ˆä¾‹ç ”ç©¶
            - å›¢é˜Ÿé¡µé¢

            2. æŸ¥æ‰¾æœ‰å…³ä»¥ä¸‹å†…å®¹çš„å…·ä½“è¯¦ç»†ä¿¡æ¯ï¼š
            - å…¬å¸è¿‘æœŸæ–°é—»
            - å®¢æˆ·è¯„ä»·
            - æŠ€æœ¯åˆä½œä¼™ä¼´å…³ç³»
            - è¡Œä¸šå¥–é¡¹
            - å¢é•¿æŒ‡æ ‡

            3. è¯†åˆ«æ½œåœ¨ç—›ç‚¹ï¼š
            - å¯æ‰©å±•æ€§æŒ‘æˆ˜
            - å¸‚åœºå‹åŠ›
            - æŠ€æœ¯é™åˆ¶
            - è¿è¥æ•ˆç‡ä½ä¸‹

            4. ä¸“æ³¨äºå¯è¡Œçš„è§è§£ï¼Œè¿™äº›è§è§£å¯èƒ½ï¼š
            - æ¨åŠ¨ä¸šåŠ¡å¢é•¿
            - æ”¹è¿›è¿è¥
            - æå‡å®¢æˆ·ä½“éªŒ
            - å¢åŠ å¸‚åœºä»½é¢

            è¯·è®°ä½ï¼šè´¨é‡é‡äºæ•°é‡ã€‚ä¸“æ³¨äºå¯èƒ½å¸¦æ¥æœ‰æ„ä¹‰çš„ä¸šåŠ¡å¯¹è¯çš„è§è§£ã€‚\
        """),
        response_model=CompanyInfo,
    )

    email_creator: Agent = Agent(
        model=OpenAIChat(id="gpt-4o"),
        description=dedent("""\
            æ‚¨çš„å†™ä½œé£æ ¼æ˜¯ä¸€ä½å‹å¥½ã€æœ‰åŒç†å¿ƒçš„ 20 å²é”€å”®ä»£è¡¨ï¼Œé£æ ¼é…·ã€ç®€æ´ä¸”å°Šé‡ã€‚è¯­æ°”ä¼‘é—²ä½†ä¸“ä¸šã€‚

            - ç¤¼è²Œä½†è‡ªç„¶ï¼Œä½¿ç”¨ç®€å•çš„è¯­è¨€ã€‚
            - æ°¸è¿œä¸è¦å¬èµ·æ¥åƒæœºå™¨äººï¼Œæˆ–ä½¿ç”¨åƒâ€œæ·±å…¥ç ”ç©¶â€ã€â€œååŒä½œç”¨â€æˆ–â€œé©å‘½æ€§â€è¿™æ ·çš„å¤§ä¿—è¯­ã€‚
            - æ¸…æ™°åœ°è§£å†³æ½œåœ¨å®¢æˆ·å¯èƒ½é¢ä¸´çš„é—®é¢˜ä»¥åŠæˆ‘ä»¬å¦‚ä½•è§£å†³å®ƒä»¬ã€‚
            - æ®µè½è¦ç®€çŸ­å‹å¥½ï¼Œè¯­æ°”è‡ªç„¶ã€‚
            - ä»¥æ¸©æš–ã€ç§¯æçš„è¯­è°ƒç»“æŸï¼Œè¡¨è¾¾ä¹äºåŠ©äººçš„æ„æ„¿ã€‚\
        """),
        instructions=dedent("""\
            è¯·å†™ä¸€å°é«˜åº¦ä¸ªæ€§åŒ–çš„é‚®ä»¶ï¼Œå…¶ä¸­åŒ…å«ï¼š

            1. ä¸€ä¸ªç®€å•ã€ä¸ªæ€§åŒ–çš„ä¸»é¢˜è¡Œï¼Œå¼•ç”¨é—®é¢˜æˆ–æœºä¼šã€‚
            2. è‡³å°‘ä¸€ä¸ªæ¥è‡ªç ”ç©¶çš„æ”¹è¿›é¢†åŸŸæˆ–äº®ç‚¹ã€‚
            3. ç®€è¦è¯´æ˜æˆ‘ä»¬å¦‚ä½•å¸®åŠ©ä»–ä»¬ï¼ˆæ²¡æœ‰ç”Ÿç¡¬çš„è¡Œè¯ï¼‰ã€‚
            4. å¼•ç”¨ç ”ç©¶ä¸­å·²çŸ¥çš„æŒ‘æˆ˜ã€‚
            5. é¿å…ä½¿ç”¨â€œæ·±å…¥ç ”ç©¶â€ã€â€œæ¢ç´¢â€ã€â€œååŒâ€ã€â€œå¢å¼ºâ€ã€â€œæ”¹å˜æ¸¸æˆè§„åˆ™â€ã€â€œé©å‘½æ€§â€ã€â€œçªç ´æ€§â€ç­‰è¯è¯­ã€‚
            6. è‡ªç„¶åœ°ä½¿ç”¨ç¬¬ä¸€äººç§°è¯­è¨€ï¼ˆâ€œæˆ‘â€ï¼‰ã€‚
            7. ä¿æŒ 20 å²é’å¹´çš„å‹å¥½é£æ ¼â€”â€”ç®€æ´æ˜äº†ã€‚
            8. é¿å…åœ¨ä¸»é¢˜è¡Œä¸­æ”¾ç½®æ”¶ä»¶äººå§“åã€‚

            ä½¿ç”¨ä»¥ä¸‹ç»“æ„æ¨¡æ¿ï¼Œä½†ç¡®ä¿æœ€ç»ˆè¯­æ°”æ„Ÿè§‰ä¸ªæ€§åŒ–ä¸”å¯¹è¯åŒ–ï¼Œè€Œä¸æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼š
            ----------------------------------------------------------------------
            """)
        + "è¦ä½¿ç”¨çš„é‚®ä»¶æ¨¡æ¿:\n"
        + email_template,
        markdown=False,
        add_datetime_to_instructions=True,
    )

    def get_cached_company_data(self, company_name: str) -> Optional[CompanyInfo]:
        """æ£€ç´¢ç¼“å­˜çš„å…¬å¸ç ”ç©¶æ•°æ®"""
        logger.info(f"æ­£åœ¨æ£€æŸ¥ç¼“å­˜ä¸­çš„å…¬å¸æ•°æ®ï¼š{company_name}")
        cached_data = self.session_state.get("company_research", {}).get(company_name)
        if cached_data:
            return CompanyInfo.model_validate(cached_data)
        return None

    def cache_company_data(self, company_name: str, company_data: CompanyInfo):
        """ç¼“å­˜å…¬å¸ç ”ç©¶æ•°æ®"""
        logger.info(f"æ­£åœ¨ç¼“å­˜ {company_name} çš„å…¬å¸æ•°æ®")
        self.session_state.setdefault("company_research", {})
        self.session_state["company_research"][company_name] = company_data.model_dump()
        self.write_to_storage()

    def get_cached_email(self, company_name: str) -> Optional[str]:
        """æ£€ç´¢ç¼“å­˜çš„é‚®ä»¶å†…å®¹"""
        logger.info(f"æ­£åœ¨æ£€æŸ¥ç¼“å­˜ä¸­çš„é‚®ä»¶ï¼š{company_name}")
        return self.session_state.get("generated_emails", {}).get(company_name)

    def cache_email(self, company_name: str, email_content: str):
        """ç¼“å­˜ç”Ÿæˆçš„é‚®ä»¶å†…å®¹"""
        logger.info(f"æ­£åœ¨ç¼“å­˜ {company_name} çš„é‚®ä»¶")
        self.session_state.setdefault("generated_emails", {})
        self.session_state["generated_emails"][company_name] = email_content
        self.write_to_storage()

    def run(
        self,
        use_research_cache: bool = True,
        use_email_cache: bool = True,
    ) -> Iterator[RunResponse]:
        """
        åè°ƒæ•´ä¸ªä¸ªæ€§åŒ–è¥é”€å·¥ä½œæµï¼š

        1. æŸ¥æ‰¾æˆ–ä»ç¼“å­˜ä¸­æ£€ç´¢å…¬å¸æ•°æ®ã€‚
        2. å¦‚æœæœªç¼“å­˜ï¼Œåˆ™ä½¿ç”¨ scraper agent ç ”ç©¶å…¬å¸ç½‘ç«™ã€‚
        3. å°†è¯¥æ•°æ®ä¼ é€’ç»™ email_creator agent ä»¥ç”Ÿæˆæœ‰é’ˆå¯¹æ€§çš„é‚®ä»¶ã€‚
        4. äº§ç”Ÿç”Ÿæˆçš„é‚®ä»¶å†…å®¹ä»¥ä¾›å®¡é˜…æˆ–åˆ†å‘ã€‚
        """
        logger.info("æ­£åœ¨å¯åŠ¨ä¸ªæ€§åŒ–è¥é”€å·¥ä½œæµ...")

        for company_name, company_info in leads.items():
            try:
                logger.info(f"æ­£åœ¨å¤„ç†å…¬å¸ï¼š{company_name}")

                # é¦–å…ˆæ£€æŸ¥é‚®ä»¶ç¼“å­˜
                if use_email_cache:
                    cached_email = self.get_cached_email(company_name)
                    if cached_email:
                        logger.info(f"æ­£åœ¨ä¸º {company_name} ä½¿ç”¨ç¼“å­˜çš„é‚®ä»¶")
                        yield RunResponse(content=cached_email)
                        continue

                # 1. ç ”ç©¶é˜¶æ®µï¼ˆå¸¦ç¼“å­˜ï¼‰
                company_data = None
                if use_research_cache:
                    company_data = self.get_cached_company_data(company_name)
                    if company_data:
                        logger.info(f"æ­£åœ¨ä¸º {company_name} ä½¿ç”¨ç¼“å­˜çš„å…¬å¸æ•°æ®")

                if not company_data:
                    logger.info("æ­£åœ¨å¼€å§‹å…¬å¸ç ”ç©¶...")
                    scraper_response = self.scraper.run(
                        json.dumps(company_info, indent=4)
                    )

                    if not scraper_response or not scraper_response.content:
                        logger.warning(
                            f"æœªèƒ½ä¸º {company_name} è¿”å›æ•°æ®ã€‚æ­£åœ¨è·³è¿‡ã€‚"
                        )
                        continue

                    company_data = scraper_response.content
                    if not isinstance(company_data, CompanyInfo):
                        logger.error(
                            f"{company_name} çš„æ•°æ®æ ¼å¼æ— æ•ˆã€‚æ­£åœ¨è·³è¿‡ã€‚"
                        )
                        continue

                    # ç¼“å­˜ç ”ç©¶ç»“æœ
                    self.cache_company_data(company_name, company_data)

                # 2. ç”Ÿæˆé‚®ä»¶
                logger.info("æ­£åœ¨ç”Ÿæˆä¸ªæ€§åŒ–é‚®ä»¶...")
                email_context = json.dumps(
                    {
                        "contact_name": company_info.get(
                            "contact_name", "å†³ç­–è€…"
                        ),
                        "position": company_info.get("position", "é¢†å¯¼è€…"),
                        "company_info": company_data.model_dump(),
                        "recipient_email": sender_details_dict["email"],
                        "sender_details": sender_details_dict,
                    },
                    indent=4,
                )
                yield from self.email_creator.run(
                    f"è¯·ä½¿ç”¨æ­¤ä¸Šä¸‹æ–‡ç”Ÿæˆä¸€å°ä¸ªæ€§åŒ–é‚®ä»¶ï¼š\n{email_context}",
                    stream=True,
                )

                # ç¼“å­˜ç”Ÿæˆçš„é‚®ä»¶å†…å®¹
                self.cache_email(company_name, self.email_creator.run_response.content)

                # è·å–æœ€ç»ˆé‚®ä»¶å†…å®¹ï¼š
                email_content = self.email_creator.run_response.content

                # 3. å¦‚æœä¸æ˜¯æ¼”ç¤ºæ¨¡å¼ï¼Œæ‚¨å°†åœ¨æ­¤å¤„å¤„ç†å‘é€é‚®ä»¶çš„é€»è¾‘ã€‚
                #    å®ç°ç»†èŠ‚å·²çœç•¥ã€‚
                if not DEMO_MODE:
                    logger.info(
                        "ç”Ÿäº§æ¨¡å¼ï¼šæ­£åœ¨å°è¯•å°†é‚®ä»¶å‘é€ç»™è‡ªå·±..."
                    )
                    # åœ¨æ­¤å¤„æ”¾ç½®å‘é€é‚®ä»¶çš„å®ç°ã€‚

            except Exception as e:
                logger.error(f"å¤„ç† {company_name} æ—¶å‡ºé”™ï¼š{e}")
                raise


def main():
    """
    è¿è¡Œä¸ªæ€§åŒ–é‚®ä»¶ç”Ÿæˆå™¨å·¥ä½œæµçš„ä¸»å…¥å£ç‚¹ã€‚
    """
    try:
        # ä½¿ç”¨ SQLite å­˜å‚¨åˆ›å»ºå·¥ä½œæµ
        workflow = PersonalisedEmailGenerator(
            session_id="personalized-email-generator",
            storage=SqliteStorage(
                table_name="personalized_email_workflows",
                db_file="tmp/agno_workflows.db",
            ),
        )

        # è¿è¡Œå¸¦ç¼“å­˜çš„å·¥ä½œæµ
        responses = workflow.run(
            use_research_cache=True,
            use_email_cache=False,
        )

        # å¤„ç†å¹¶ç¾åŒ–æ‰“å°å“åº”
        pprint_run_response(responses, markdown=True)

        logger.info("å·¥ä½œæµæˆåŠŸå®Œæˆï¼")
    except Exception as e:
        logger.error(f"å·¥ä½œæµå¤±è´¥ï¼š{e}")
        raise


if __name__ == "__main__":
    main()
```

## ç”¨æ³•

<Steps>
  <Snippet file="create-venv-step.mdx" />

  <Step title="å®‰è£…åº“">
    ```bash
    pip install openai exa_py agno
    ```
  </Step>

  <Step title="è¿è¡Œä»£ç†">
    ```bash
    python personalized_email_generator.py
    ```
  </Step>

</Steps>