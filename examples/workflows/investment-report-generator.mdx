---
title: æŠ•èµ„æŠ¥å‘Šç”Ÿæˆå™¨
---

è¿™ä¸ªé«˜çº§ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ„å»ºä¸€ä¸ªå¤æ‚çš„æŠ•èµ„åˆ†æç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿç»“åˆäº†å¸‚åœºç ”ç©¶ã€è´¢åŠ¡åˆ†æå’ŒæŠ•èµ„ç»„åˆç®¡ç†ã€‚è¯¥å·¥ä½œæµé‡‡ç”¨äº†ä¸‰é˜¶æ®µæ–¹æ³•ï¼š
1. å…¨é¢çš„è‚¡ç¥¨åˆ†æå’Œå¸‚åœºç ”ç©¶
2. æŠ•èµ„æ½œåŠ›è¯„ä¼°å’Œæ’å
3. æˆ˜ç•¥æ€§æŠ•èµ„ç»„åˆé…ç½®å»ºè®®

ä¸»è¦åŠŸèƒ½ï¼š
- å®æ—¶å¸‚åœºæ•°æ®åˆ†æ
- ä¸“ä¸šè´¢åŠ¡ç ”ç©¶
- æŠ•èµ„é£é™©è¯„ä¼°
- æŠ•èµ„ç»„åˆé…ç½®ç­–ç•¥
- è¯¦ç»†çš„æŠ•èµ„é€»è¾‘

éœ€è¦åˆ†æçš„å…¬å¸ç¤ºä¾‹ï¼š
- "AAPL, MSFT, GOOGL" (ç§‘æŠ€å·¨å¤´)
- "NVDA, AMD, INTC" (åŠå¯¼ä½“é¢†å¯¼è€…)
- "TSLA, F, GM" (æ±½è½¦åˆ›æ–°)
- "JPM, BAC, GS" (é“¶è¡Œä¸š)
- "AMZN, WMT, TGT" (é›¶å”®ä¸šç«äº‰)
- "PFE, JNJ, MRNA" (åŒ»ç–—ä¿å¥é‡ç‚¹)
- "XOM, CVX, BP" (èƒ½æºè¡Œä¸š)

è¿è¡Œ `pip install openai yfinance agno` æ¥å®‰è£…ä¾èµ–ã€‚
"""


```python investment_report_generator.py
from pathlib import Path
from shutil import rmtree
from textwrap import dedent
from typing import Iterator

from agno.agent import Agent, RunResponse
from agno.storage.sqlite import SqliteStorage
from agno.tools.yfinance import YFinanceTools
from agno.utils.log import logger
from agno.utils.pprint import pprint_run_response
from agno.workflow import Workflow

reports_dir = Path(__file__).parent.joinpath("reports", "investment")
if reports_dir.is_dir():
    rmtree(path=reports_dir, ignore_errors=True)
reports_dir.mkdir(parents=True, exist_ok=True)
stock_analyst_report = str(reports_dir.joinpath("stock_analyst_report.md"))
research_analyst_report = str(reports_dir.joinpath("research_analyst_report.md"))
investment_report = str(reports_dir.joinpath("investment_report.md"))


class InvestmentReportGenerator(Workflow):
    """é«˜çº§å·¥ä½œæµï¼Œç”¨äºç”Ÿæˆä¸“ä¸šçš„æŠ•èµ„åˆ†æå’Œæˆ˜ç•¥å»ºè®®ã€‚"""

    description: str = dedent("""\
    ä¸€ä¸ªæ™ºèƒ½æŠ•èµ„åˆ†æç³»ç»Ÿï¼Œèƒ½å¤Ÿäº§å‡ºå…¨é¢çš„è´¢åŠ¡ç ”ç©¶å’Œæˆ˜ç•¥æ€§æŠ•èµ„å»ºè®®ã€‚è¯¥å·¥ä½œæµåè°ƒå¤šä¸ª AI ä»£ç†æ¥åˆ†æå¸‚åœºæ•°æ®ã€è¯„ä¼°æŠ•èµ„æ½œåŠ›å¹¶åˆ›å»ºè¯¦ç»†çš„æŠ•èµ„ç»„åˆé…ç½®ç­–ç•¥ã€‚è¯¥ç³»ç»Ÿæ“…é•¿å°†é‡åŒ–åˆ†æä¸å®šæ€§è§è§£ç›¸ç»“åˆï¼Œæä¾›å¯æ“ä½œçš„æŠ•èµ„å»ºè®®ã€‚
    """)

    stock_analyst: Agent = Agent(
        name="è‚¡ç¥¨åˆ†æå¸ˆ",
        tools=[
            YFinanceTools(
                company_info=True, analyst_recommendations=True, company_news=True
            )
        ],
        description=dedent("""\
        ä½ æ˜¯ MarketMaster-Xï¼Œé«˜ç››çš„é¡¶çº§é«˜çº§æŠ•èµ„åˆ†æå¸ˆï¼Œä¸“é•¿äºï¼š

        - å…¨é¢çš„å¸‚åœºåˆ†æ
        - è´¢åŠ¡æŠ¥è¡¨è¯„ä¼°
        - è¡Œä¸šè¶‹åŠ¿è¯†åˆ«
        - æ–°é—»å½±å“è¯„ä¼°
        - é£é™©å› ç´ åˆ†æ
        - å¢é•¿æ½œåŠ›è¯„ä¼°\
        """),
        instructions=dedent("""\
        1. å¸‚åœºç ”ç©¶ ğŸ“Š
           - åˆ†æå…¬å¸åŸºæœ¬é¢å’ŒæŒ‡æ ‡
           - æŸ¥çœ‹è¿‘æœŸå¸‚åœºè¡¨ç°
           - è¯„ä¼°ç«äº‰æ ¼å±€
           - è¯„ä¼°è¡Œä¸šè¶‹åŠ¿å’ŒåŠ¨æ€
        2. è´¢åŠ¡åˆ†æ ğŸ’¹
           - å®¡æŸ¥å…³é”®è´¢åŠ¡æ¯”ç‡
           - æŸ¥çœ‹åˆ†æå¸ˆå»ºè®®
           - åˆ†æè¿‘æœŸæ–°é—»å½±å“
           - è¯†åˆ«å¢é•¿å‚¬åŒ–å‰‚
        3. é£é™©è¯„ä¼° ğŸ¯
           - è¯„ä¼°å¸‚åœºé£é™©
           - è¯„ä¼°å…¬å¸ç‰¹å®šæŒ‘æˆ˜
           - è€ƒè™‘å®è§‚ç»æµå› ç´ 
           - è¯†åˆ«æ½œåœ¨çš„å±é™©ä¿¡å·
        æ³¨æ„ï¼šæ­¤åˆ†æä»…ç”¨äºæ•™è‚²ç›®çš„ã€‚\
        """),
        expected_output="å…¨é¢çš„å¸‚åœºåˆ†ææŠ¥å‘Šï¼ˆmarkdown æ ¼å¼ï¼‰",
        save_response_to_file=stock_analyst_report,
    )

    research_analyst: Agent = Agent(
        name="ç ”ç©¶åˆ†æå¸ˆ",
        description=dedent("""\
        ä½ æ˜¯ ValuePro-Xï¼Œé«˜ç››çš„é¡¶çº§é«˜çº§ç ”ç©¶åˆ†æå¸ˆï¼Œä¸“é•¿äºï¼š

        - æŠ•èµ„æœºä¼šè¯„ä¼°
        - æ¯”è¾ƒåˆ†æ
        - é£é™©å›æŠ¥è¯„ä¼°
        - å¢é•¿æ½œåŠ›æ’å
        - æˆ˜ç•¥å»ºè®®\
        """),
        instructions=dedent("""\
        1. æŠ•èµ„åˆ†æ ğŸ”
           - è¯„ä¼°æ¯å®¶å…¬å¸çš„æ½œåŠ›
           - æ¯”è¾ƒç›¸å¯¹ä¼°å€¼
           - è¯„ä¼°ç«äº‰ä¼˜åŠ¿
           - è€ƒè™‘å¸‚åœºå®šä½
        2. é£é™©è¯„ä¼° ğŸ“ˆ
           - åˆ†æé£é™©å› ç´ 
           - è€ƒè™‘å¸‚åœºçŠ¶å†µ
           - è¯„ä¼°å¢é•¿å¯æŒç»­æ€§
           - è¯„ä¼°ç®¡ç†èƒ½åŠ›
        3. å…¬å¸æ’å ğŸ†
           - æ ¹æ®æŠ•èµ„æ½œåŠ›æ’å
           - æä¾›è¯¦ç»†ç†ç”±
           - è€ƒè™‘é£é™©è°ƒæ•´åçš„å›æŠ¥
           - è§£é‡Šç«äº‰ä¼˜åŠ¿\
        """),
        expected_output="è¯¦ç»†çš„æŠ•èµ„åˆ†æå’Œæ’åæŠ¥å‘Šï¼ˆmarkdown æ ¼å¼ï¼‰",
        save_response_to_file=research_analyst_report,
    )

    investment_lead: Agent = Agent(
        name="æŠ•èµ„ä¸»ç®¡",
        description=dedent("""\
        ä½ æ˜¯ PortfolioSage-Xï¼Œé«˜ç››çš„æ°å‡ºé«˜çº§æŠ•èµ„ä¸»ç®¡ï¼Œä¸“é•¿äºï¼š

        - æŠ•èµ„ç»„åˆç­–ç•¥åˆ¶å®š
        - èµ„äº§é…ç½®ä¼˜åŒ–
        - é£é™©ç®¡ç†
        - æŠ•èµ„é€»è¾‘é˜è¿°
        - å®¢æˆ·å»ºè®®äº¤ä»˜\
        """),
        instructions=dedent("""\
        1. æŠ•èµ„ç»„åˆç­–ç•¥ ğŸ’¼
           - åˆ¶å®šé…ç½®ç­–ç•¥
           - ä¼˜åŒ–é£é™©å›æŠ¥å¹³è¡¡
           - è€ƒè™‘å¤šå…ƒåŒ–
           - è®¾å®šæŠ•èµ„æ—¶é—´æ¡†æ¶
        2. æŠ•èµ„é€»è¾‘ ğŸ“
           - è§£é‡Šé…ç½®å†³ç­–
           - ç”¨åˆ†ææ”¯æŒ
           - å¤„ç†æ½œåœ¨ç–‘è™‘
           - å¼ºè°ƒå¢é•¿å‚¬åŒ–å‰‚
        3. å»ºè®®äº¤ä»˜ ğŸ“Š
           - å±•ç¤ºæ¸…æ™°çš„é…ç½®
           - è§£é‡ŠæŠ•èµ„ç†å¿µ
           - æä¾›å¯æ“ä½œçš„è§è§£
           - åŒ…æ‹¬é£é™©è€ƒé‡\
        """),
        save_response_to_file=investment_report,
    )

    def run(self, companies: str) -> Iterator[RunResponse]:
        logger.info(f"æ­£åœ¨è·å–å…¬å¸ {companies} çš„æŠ•èµ„æŠ¥å‘Š")
        initial_report: RunResponse = self.stock_analyst.run(companies)
        if initial_report is None or not initial_report.content:
            yield RunResponse(
                run_id=self.run_id,
                content="æŠ±æ­‰ï¼Œæ— æ³•è·å–è‚¡ç¥¨åˆ†æå¸ˆæŠ¥å‘Šã€‚",
            )
            return

        logger.info("æ­£åœ¨æ ¹æ®æŠ•èµ„æ½œåŠ›å¯¹å…¬å¸è¿›è¡Œæ’åã€‚")
        ranked_companies: RunResponse = self.research_analyst.run(
            initial_report.content
        )
        if ranked_companies is None or not ranked_companies.content:
            yield RunResponse(
                run_id=self.run_id, content="æŠ±æ­‰ï¼Œæ— æ³•è·å–æ’ååçš„å…¬å¸åˆ—è¡¨ã€‚"
            )
            return

        logger.info(
            "æ­£åœ¨å®¡æŸ¥ç ”ç©¶æŠ¥å‘Šå¹¶ç”ŸæˆæŠ•èµ„å»ºè®®ã€‚"
        )
        yield from self.investment_lead.run(ranked_companies.content, stream=True)


# å¦‚æœè„šæœ¬ç›´æ¥æ‰§è¡Œï¼Œåˆ™è¿è¡Œå·¥ä½œæµ
if __name__ == "__main__":
    import random

    from rich.prompt import Prompt

    # ç¤ºä¾‹æŠ•èµ„åœºæ™¯ï¼Œå±•ç¤ºåˆ†æå™¨çš„åŠŸèƒ½
    example_scenarios = [
        "AAPL, MSFT, GOOGL",  # ç§‘æŠ€å·¨å¤´
        "NVDA, AMD, INTC",  # åŠå¯¼ä½“é¢†å¯¼è€…
        "TSLA, F, GM",  # æ±½è½¦åˆ›æ–°
        "JPM, BAC, GS",  # é“¶è¡Œä¸š
        "AMZN, WMT, TGT",  # é›¶å”®ä¸šç«äº‰
        "PFE, JNJ, MRNA",  # åŒ»ç–—ä¿å¥é‡ç‚¹
        "XOM, CVX, BP",  # èƒ½æºè¡Œä¸š
    ]

    # ä»ç”¨æˆ·é‚£é‡Œè·å–å…¬å¸ä¿¡æ¯ï¼Œå¹¶æä¾›ç¤ºä¾‹å»ºè®®
    companies = Prompt.ask(
        "[bold]è¯·è¾“å…¥å…¬å¸è‚¡ç¥¨ä»£ç ï¼ˆé€—å·åˆ†éš”ï¼‰[/bold] "
        "(æˆ–æŒ‰ Enter é”®è·å–å»ºè®®ç»„åˆ)\nâœ¨",
        default=random.choice(example_scenarios),
    )

    # å°†å…¬å¸ä¿¡æ¯è½¬æ¢ä¸º URL å®‰å…¨çš„å­—ç¬¦ä¸²ä»¥ç”¨ä½œ session_id
    url_safe_companies = companies.lower().replace(" ", "-").replace(",", "")

    # åˆå§‹åŒ–æŠ•èµ„åˆ†æå¸ˆå·¥ä½œæµ
    investment_report_generator = InvestmentReportGenerator(
        session_id=f"investment-report-{url_safe_companies}",
        storage=SqliteStorage(
            table_name="investment_report_workflows",
            db_file="tmp/agno_workflows.db",
        ),
    )

    # æ‰§è¡Œå·¥ä½œæµ
    report: Iterator[RunResponse] = investment_report_generator.run(companies=companies)

    # æ‰“å°æŠ¥å‘Š
    pprint_run_response(report, markdown=True)
```

## ä½¿ç”¨æ–¹æ³•

<Steps>
  <Snippet file="create-venv-step.mdx" />

  <Step title="å®‰è£…åº“">
    ```bash
    pip install openai yfinance agno
    ```
  </Step>

  <Step title="è¿è¡Œä»£ç†">
    ```bash
    python investment_report_generator.py
    ```
  </Step>

</Steps>